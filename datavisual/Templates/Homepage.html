<!DOCTYPE html>
<html lang="en">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    {%load static%}<link href="{%static 'css/bootstrap.min.css'%}" rel="stylesheet"> 
    {%load static%}<link href="{%static 'style.css'%}" rel="stylesheet">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome</title>
</head>
<body>
    <body class="fixed-nav sticky-footer bg-dark" id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
          <a class="navbar-brand text-white">Jon's</a>
          <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav navbar-sidenav" id="exampleAccordion">
              <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Dashboard">
                <a class="nav-link">
                  <i class="fa fa-fw fa-dashboard"></i>
                  <img src="{%static 'img/compost.png'%}" height="150px" width="150px">
                  <span class="nav-link-text">Sensors</span>
                </a>
              </li>
              <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Charts">
                <a class="nav-link" >
                  <i class="fa fa-fw fa-area-chart"></i>
                  <span class="nav-link-text">Actuators</span>
                </a>
              </li>
              <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Tables">
                <a class="nav-link" >
                  <i class="fa fa-fw fa-table"></i>
                  <span class="nav-link-text">Calendar</span>
                </a>
              </li>
              <!-- <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Components">
                <a class="nav-link nav-link-collapse collapsed" data-toggle="collapse" data-parent="#exampleAccordion">
                  <i class="fa fa-fw fa-wrench"></i>
                  <span class="nav-link-text">Chart</span>
                </a>
              </li> -->
            </ul>   
            <ul>         
              <li class="nav-item">
                <form class="form-inline my-2 my-lg-0 mr-lg-2">
                  <div class="input-group">
                    <input class="form-control" type="text" placeholder="Search for...">
                    <span class="input-group-append">
                      <button class="btn btn-primary" type="button">
                        <i class="fa fa-search"></i>
                      </button>
                    </span>
                  </div>
                </form>
              </li>
            </ul>
          </div>
        </nav>
        <div class="content-wrapper">
          <div class="container-fluid">

            <!-- Sensors-->
            <ol class="breadcrumb">
              <li class="breadcrumb-item active">Sensors</li>
            </ol>
            <!-- Icon Cards-->
            <div class="row">
              <div class="col-xl-3 col-sm-6 mb-3">
                <div class="card text-white bg-primary o-hidden">
                  <div class="card-body">
                    <img src="{%static 'img/thermo.png'%}" height="150px" width="150px">
                    <div>Temperature</div>
                    <div id="Temperature">-</div>
                  </div>
                  <!-- <a class="card-footer text-white clearfix small z-1" href="#">
                    <span class="float-left">View Details</span>
                    <span class="float-right">
                      <i class="fa fa-angle-right"></i>
                    </span>
                  </a> -->
                </div>
              </div>
              <div class="col-xl-3 col-sm-6 mb-3">
                <div class="card text-white bg-warning o-hidden">
                  <div class="card-body">
                    <img src="{%static 'img/humid.png'%}" height="150px" width="150px">
                    <div>Humidity</div>
                    <div id="Humidity">-</div>
                  </div>
                  <!-- <a class="card-footer text-white clearfix small z-1" href="#">
                    <span class="float-left">View Details</span>
                    <span class="float-right">
                      <i class="fa fa-angle-right"></i>
                    </span>
                  </a> -->
                </div>
              </div>
              <div class="col-xl-3 col-sm-6 mb-3">
                <div class="card text-white bg-success o-hidden">
                  <div class="card-body">
                    <img src="{%static 'img/moisture.png'%}" height="150px" width="150px">
                    <div>Moisture Level</div>
                    <div id="MoistureLevel">-</div>
                  </div>
                  <!-- <a class="card-footer text-white clearfix small z-1" href="#">
                    <span class="float-left">View Details</span>
                    <span class="float-right">
                      <i class="fa fa-angle-right"></i>
                    </span>
                  </a> -->
                </div>
              </div>
              </div>
            </div>

            <!--Actuators-->
            <ol class="breadcrumb">
                <li class="breadcrumb-item active">Actuators</li>
            </ol>
            <div class="row">
                <div class="col-xl-3 col-sm-6 mb-3">
                  <div class="actuator text-white bg-primary o-hidden h-100">
                    <div class="card-body">
                      <div class="card-body-icon">
                        <i class="fa fa-fw fa-comments"></i>
                      </div>
                      <div class="inner">
                          <img src="{%static 'img/agitator.png'%}" height="150px" width="150px">
                          <label class="switch">
                            <input class="actuator_sensor" id="1" type="checkbox"> 
                            <div class="slider round"></div>
                          </label>
                      </div>
                    </div>
                    <!-- <a class="card-footer text-white clearfix small z-1" href="#">
                      <span class="float-left">View Details</span>
                      <span class="float-right">
                        <i class="fa fa-angle-right"></i>
                      </span>
                    </a> -->
                  </div>
                </div>
                <div class="col-xl-3 col-sm-6 mb-3">
                  <div class="actuator text-white bg-warning o-hidden h-100">
                    <div class="card-body">
                      <div class="card-body-icon">
                        <i class="fa fa-fw fa-list"></i>
                      </div>
                      <div class="inner">
                        <img src="{%static 'img/air.png'%}" height="150px" width="150px">
                        <label class="switch">
                          <input class="actuator_sensor" id="2" type="checkbox"> 
                          <div class="slider round"></div>
                        </label>
                      </div>
                    </div>
                    <!-- <a class="card-footer text-white clearfix small z-1" href="#">
                      <span class="float-left">View Details</span>
                      <span class="float-right">
                        <i class="fa fa-angle-right"></i>
                      </span>
                    </a> -->
                  </div>
                </div>
                <div class="col-xl-3 col-sm-6 mb-3">
                  <div class="actuator text-white bg-success o-hidden h-100">
                    <div class="card-body">
                      <div class="card-body-icon">
                        <i class="fa fa-fw fa-shopping-cart"></i>
                      </div>
                        <div class="inner">
                            <img src="{%static 'img/water.png'%}" height="150px" width="150px">
                            <label class="switch">
                              <input class="actuator_sensor" id="3" type="checkbox"> 
                              <div class="slider round"></div>
                            </label>
                        </div>
                    </div>

                    <!-- <a class="card-footer text-white clearfix small z-1" href="#">
                      <span class="float-left">View Details</span>
                      <span class="float-right">
                        <i class="fa fa-angle-right"></i>
                      </span>
                    </a> -->
                    </div>
                </div>
                <div class="col-xl-3 col-sm-6 mb-3">
                  <div class="actuator text-white bg-danger o-hidden h-100">
                    <div class="card-body">
                        <div class="card-body-icon">
                            <i class="fa fa-fw fa-support"></i>
                        </div>
                        <div class="inner">
                            <img src="{%static 'img/heater.png'%}" height="150px" width="100px">
                            <label class="switch">
                              <input class="actuator_sensor" id="4" type="checkbox"> 
                              <div class="slider round"></div>
                            </label>
                        </div>
                    </div>
                    <!-- <a class="card-footer text-white clearfix small z-1" href="#">
                      <span class="float-left">View Details</span>
                      <span class="float-right">
                        <i class="fa fa-angle-right"></i>
                      </span>
                    </a> -->
                  </div>
                </div>
            <!-- Area Chart Example -->
            <!-- <div class="card mb-3">
              <div class="card-header">
                <i class="fa fa-area-chart"></i> Area Chart Example</div>
              <div class="card-body">
                <canvas id="myAreaChart" width="100%" height="30"></canvas>
              </div>
              <div class="card-footer small text-muted">Updated yesterday at 11:59 PM</div>
            </div>
            <div class="row">
              <div class="col-lg-8">
                <-- Example Bar Chart Card-->
                <!-- <div class="card mb-3">
                  <div class="card-header">
                    <i class="fa fa-bar-chart"></i> Bar Chart Example</div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-sm-8 my-auto">
                        <canvas id="myBarChart" width="100" height="50"></canvas>
                      </div>
                      <div class="col-sm-4 text-center my-auto">
                        <div class="h4 mb-0 text-primary">$34,693</div>
                        <div class="small text-muted">YTD Revenue</div>
                        <hr>
                        <div class="h4 mb-0 text-warning">$18,474</div>
                        <div class="small text-muted">YTD Expenses</div>
                        <hr>
                        <div class="h4 mb-0 text-success">$16,219</div>
                        <div class="small text-muted">YTD Margin</div>
                      </div>
                    </div>
                  </div>
                  <div class="card-footer small text-muted">Updated yesterday at 11:59 PM</div>
                </div> -->
                <!-- Card Columns Example Social Feed-->
                <!-- /Card Columns-->
              <!-- <div class="col-lg-4">
                <-- Example Pie Chart Card-->
                <!-- <div class="card mb-3">
                  <div class="card-header">
                    <i class="fa fa-pie-chart"></i> Pie Chart Example</div>
                  <div class="card-body">
                    <canvas id="myPieChart" width="100%" height="100"></canvas>
                  </div>
                  <div class="card-footer small text-muted">Updated yesterday at 11:59 PM</div>
                </div> -->
      </body>
    
    <!-- <div class="meterbar2">
        <div id="gauge"><p id="Temperature">Hi</p></div>
        <div id="gauge"><p id="Humidity">Hi</p></div>
        <div id="gauge"><p id="MoistureLevel">Hi</p></div>
    </div>
    <div>
        <input id="1" class="waterpump" type="checkbox"> 
    </div> -->
    {%load static%}<script src="{% static 'js/bootstrap.min.js' %}"></script>  
    {%load static%}<script src="{% static 'template.js' %}"></script>  
    <script>
        $(document).ready(function(){
            $('.actuator_sensor').click(function() {
                var element_ID = $(this).attr("id");
                console.log(element_ID)
                if ($(this).is(':checked')) {
                    state = 1;
                    controls(element_ID, state);
                }
                else {
                    state= 0;
                    controls(element_ID, state);
                }
            });
            setInterval(readings,1000);
            }
        );
        function readings(){
            $.ajax({
                type: "GET",
                url: "api/getreadings",
                dataType:'json',
                success: function(data){
                    json = data["data"];
                    var dat = json.reverse(data);
                    conv_val = dat[0];
                    $("#Temperature").html(conv_val["Temperature"])
                    $("#Humidity").html(conv_val["Humidity"])
                    $("#MoistureLevel").html(conv_val["MoistureLevel"])
                    }
                });         
            };
        function controls(element_ID, state){
            csrfmiddlewaretoken: '{{ csrf_token }}' 
            $.ajax({
                type: "POST",
                url: "api/controls",
                data:{
                    "ActuatorID": element_ID,
                    "Value":state,
                    "csrfmiddlewaretoken": '{{ csrf_token }}',
                },
                dataType:'json',
                success: function(data){  
                    console.log(data);
                }     
            });
        }
    </script>
</body>
</html>